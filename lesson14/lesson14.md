# Робота з software RAID
Додамо 4 віртуальних жорстких диски у віртуальну машину, попередньо при цьому вимкнувши її. Оскільки ми не збираємося заповнювати під завʼязку результуючу файлову систему даними, можна залишити параметри за замовчуванням. Чотири віртуальних пристрої займатимуть не 80 Гб, а стільки, скільки реально записано на них даних - головне переконатися, що прапорець `Pre-allocate disk space` знятий

![Додавання нового пустого віртуального HDD в VMware](wm_new_hdd.png)

Після додавання віртуальних носіїв завантажимо віртуальну машину і перевіримо стан справ командою `lsblk`. Як бачимо, до нашого пристрою `/dev/sda` додалися пристрої `/dev/sdb`, `/dev/sdc`, `/dev/sdd` та `/dev/sde`.

![Список дисків в lsblk](lsblk.png)

Утиліти mdadm в стандартній поставці немає, тому швидко її встановимо одним рядком:
```bash
sudo apt update && sudo apt -y install mdadm
```

## Для початку створимо RAID1
Для цього запустимо команду
```bash
sudo mdadm --create --verbose /dev/md0 --level=1 --raid-devices=2 /dev/sdb /dev/sdc
```

![RAID1 масив запущено](md0-started.png)

Після створення RAID-масиву вивід команди `lsblk` виглядає набагато цікавіше. Додалася інформація, що пристрої `/dev/sdb` та `/dev/sdc` є складовою віртуального RAID0-пристрою.

![Список дисків в lsblk після створення RAID-масиву](lsblk-md0.png)

В принципі, тепер можна створити на цьому пристрої файлову систему командою `sudo mkfs.ext4 /dev/md0`, а потім змонтувати її і перевірити вільний простір. В кінці обовʼязково треба розмонтувати її, оскільки ми сюди прийшли не за цим і пристрій `/dev/md0` нам ще знадобиться

![Тестове створення фс на RAID-пристрої](ext4-test.png)

## Створюємо ще один RAID1 масив
Використаємо інші два віртуальні HDD
```bash
sudo mdadm --create --verbose /dev/md1 --level=1 --raid-devices=2 /dev/sdd /dev/sde
```
![Ще один RAID1 масив запущено](md1-started.png)

Тепер вивід команди `lsblk` виглядає так:

![Список дисків в lsblk після створення ще одного RAID-масиву](lsblk-md1.png)

# Робота з LVM
## Встановлення LVM в систему
LVM немає в базовій системі, так само, як і mdadm. При спробі встановити lvm, пакетний менеджер повідомляє, що такого пакета не існує. Але очевидно, що його назва починається з 'lvm'

Скориставшись швидким пошуком за допомогою команди `apt search --names-only '^lvm'` отримаємо однозначну відповідь - пакет називається `lvm2`

![Пошук пакету LVM в репозиторії](lvm-apt-search.png)

Запустимо команду `sudo apt update && sudo apt -y install lvm2` і почнемо роботу з LVM

## Створюємо логічний LVM-том поверх двох RAID-масивів
# Ініціалізуємо наші віртуальні RAID-пристрої для роботи з LVM.
```bash
pvcreate /dev/md0 /dev/md1
```
На /dev/md0 і /dev/md1 було записано спеціальні заголовки і тепер ці пристрої відображаються у виводі команди `pvscan`:

![Ініціалізація фізичних пристроїв для роботи з LVM](pvcreate.png)

Детальну інформацію про фізичні томи можна дізнатися по команді `pvdisplay /dev/md0 /dev/md1`. Команда без `pvdisplay` без аргументів виведе дані про всі фізичні томи, а тому в нашому випадку спрацює так само.

![Дані про фізичні томи LVM](pvdisplay.png)

# Створюємо віртуальну групу томів
Фізичні томи `/dev/md0` і `/dev/md1` готові. Створимо з них групу томів для робити з LVM. Для цього запустимо команду
```bash
vgcreate vg1 /dev/md0 /dev/md1
```

![Створення групи томів для роботи з LVM](vgcreate.png)

Команда `vgdisplay` без аргументів виведе інформацію про всі групи томів. Або ж бажані томи можна вказати як аргумент:

![Інформація про створену групу томів для роботи з LVM](vgdisplay.png)

## Створюємо логічний том
Наша задача - створити один логічний том, що займе весь простір попередньо створеної групи томів. Тому просто запустимо команду
```bash
lvcreate -l 100%FREE -n lv1 vg1
```

![Створення логічного тому LVM](lvcreate.png)

Інформацію про новостворений логічний том можна дізнатися за допомого команди `lvdisplay`:

![Інформація про логічний том LVM](lvdisplay.png)

Тепер команда `lsblk` виводить дуже багато інформації:

![Список дисків в lsblk після створення логічного тому LVM](lsblk-lv1.png)

Як бачимо, остання версія LVM імплементує наш логічний том аж в три файли пристроїв: `/dev/mapper/vg1-lv1`, `/dev/vg1/lv1` і `/dev/dm-0`. Для доступу до логічного тому можна використати будь-який

![Три файли пристроїв одного логічного тому](readlink.png)

# Створюємо файлову систему на логічному томі LVM
Створення файлової системи відбувається як зазвичай:
```bash
mkfs.ext4 /dev/mapper/vg1-lv1
```

![Створення файлової системи на логічному томі](mkfs-lv1.png)

# Робота з user quota
*TODO*
## Монтування командою `mount`
## Монтування через `/etc/fstab`
## Вмикання квот
## Налаштування обмежень для користувача
## Налаштування обмежень для групи
## Вивід поточних обмежень
## Спроба перевищити обмеження
